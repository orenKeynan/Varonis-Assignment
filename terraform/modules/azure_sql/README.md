# Azure SQL Module

This sub‑module creates (or re‑uses) an Azure Resource Group, a SQL Server, a single
Database, and optional firewall rules.

```hcl
module "azure_sql" {
  source = "./modules/azure_sql"

  resource_group_name    = "rg-varonis"
  location               = "West Europe"
  sql_server_name        = "varonis-sql"
  administrator_login    = "sqladmin"
  administrator_password = var.admin_password
  database_name          = "varonis_db"
  sku_name               = "GP_S_Gen5_2"

  firewall_rules = {
    office = {
      start_ip = "1.2.3.4"
      end_ip   = "1.2.3.4"
    }
  }
}
```

*All resources are tagged and `prevent_destroy` is set on the database for safety.*

<!-- BEGIN_TF_DOCS -->
## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [azurerm_key_vault_secret.sql_admin](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret) | resource |
| [azurerm_mssql_database.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_database) | resource |
| [azurerm_mssql_server.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server) | resource |
| [azurerm_private_endpoint.sql](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_admin_secret_name"></a> [admin\_secret\_name](#input\_admin\_secret\_name) | The sql admin Secret name in KV | `string` | n/a | yes |
| <a name="input_administrator_login"></a> [administrator\_login](#input\_administrator\_login) | Administrator username for the MSSQL Server. | `string` | n/a | yes |
| <a name="input_administrator_login_password"></a> [administrator\_login\_password](#input\_administrator\_login\_password) | admin password. generated by terraform. saved in keyvault\_secret | `string` | n/a | yes |
| <a name="input_auto_pause_delay_in_minutes"></a> [auto\_pause\_delay\_in\_minutes](#input\_auto\_pause\_delay\_in\_minutes) | pause instance after X amount of minutes | `number` | `null` | no |
| <a name="input_database_name"></a> [database\_name](#input\_database\_name) | Name of the MSSQL database to create. | `string` | n/a | yes |
| <a name="input_geo_backup_enabled"></a> [geo\_backup\_enabled](#input\_geo\_backup\_enabled) | Backup the database | `bool` | `true` | no |
| <a name="input_key_vault_id"></a> [key\_vault\_id](#input\_key\_vault\_id) | ID of the Key Vaulr | `string` | n/a | yes |
| <a name="input_location"></a> [location](#input\_location) | Azure region for the MSSQL resources. | `string` | n/a | yes |
| <a name="input_max_size_gb"></a> [max\_size\_gb](#input\_max\_size\_gb) | Max sotrage size of SQL | `string` | n/a | yes |
| <a name="input_min_capacity"></a> [min\_capacity](#input\_min\_capacity) | value | `string` | `null` | no |
| <a name="input_minimum_tls_version"></a> [minimum\_tls\_version](#input\_minimum\_tls\_version) | Minimum TLS Version to use. | `string` | n/a | yes |
| <a name="input_object_id"></a> [object\_id](#input\_object\_id) | Object ID of the component that is accessing the key vault | `string` | n/a | yes |
| <a name="input_pdns_zone_group_name"></a> [pdns\_zone\_group\_name](#input\_pdns\_zone\_group\_name) | Name of the Private DNS zone-group attached to the Private Endpoint. | `string` | `"sql-dns-group"` | no |
| <a name="input_pdns_zone_id"></a> [pdns\_zone\_id](#input\_pdns\_zone\_id) | ID of sql pdns sonze | `string` | n/a | yes |
| <a name="input_private_endpoints"></a> [private\_endpoints](#input\_private\_endpoints) | Map of logical name → subnet ID to create one private endpoint per subnet | `map(string)` | `{}` | no |
| <a name="input_public_network_access_enabled"></a> [public\_network\_access\_enabled](#input\_public\_network\_access\_enabled) | Enable public network | `bool` | `true` | no |
| <a name="input_read_scale"></a> [read\_scale](#input\_read\_scale) | Is sql read servers will be autoscaled | `bool` | `false` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | Name of the Resource Group where the MSSQL resources will reside. | `string` | n/a | yes |
| <a name="input_sku_name"></a> [sku\_name](#input\_sku\_name) | Azure SQL SKU name (e.g. Basic, GP\_S\_Gen5\_2). | `string` | n/a | yes |
| <a name="input_sql_server_name"></a> [sql\_server\_name](#input\_sql\_server\_name) | Globally‑unique name for the Azure MSSQL Server (do **not** include the domain). | `string` | n/a | yes |
| <a name="input_sql_version"></a> [sql\_version](#input\_sql\_version) | sql Version. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | Tags applied to all resources created by this module. | `map(string)` | `{}` | no |
| <a name="input_tenant_id"></a> [tenant\_id](#input\_tenant\_id) | Client tenant ID | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_database_id"></a> [database\_id](#output\_database\_id) | SQL Database ID |
| <a name="output_database_name"></a> [database\_name](#output\_database\_name) | Sql Database Name |
| <a name="output_server_fqdn"></a> [server\_fqdn](#output\_server\_fqdn) | SQL Server FQDN |
<!-- END_TF_DOCS -->